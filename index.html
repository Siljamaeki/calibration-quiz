<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calibration Quiz</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .setup-screen, .quiz-screen, .results-screen {
            padding: 40px;
        }
        
        .hidden {
            display: none;
        }
        
        .question-set-selector {
            margin: 20px 0;
        }
        
        .question-set-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }
        
        .question-set-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }
        
        .file-upload {
            margin: 30px 0;
            padding: 30px;
            border: 3px dashed #667eea;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload:hover {
            background: #f8f9ff;
            border-color: #764ba2;
        }
        
        .file-upload input {
            display: none;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: 600;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }
        
        .question-card {
            margin: 30px 0;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .question-text {
            font-size: 1.4em;
            margin-bottom: 30px;
            color: #333;
            font-weight: 600;
        }
        
        .options {
            margin: 20px 0;
        }
        
        .option {
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .confidence-slider {
            margin: 30px 0;
        }
        
        .confidence-slider label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
        }
        
        .confidence-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #667eea;
            min-width: 60px;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .results-toggle {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .toggle-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .toggle-btn.active {
            background: #667eea;
            color: white;
        }
        
        .chart-container {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 12px;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .results-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        
        .category-result {
            margin: 30px 0;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            text-align: center;
        }
        
        .category-result h2 {
            font-size: 2em;
            margin-bottom: 15px;
        }
        
        .category-result p {
            font-size: 1.1em;
            line-height: 1.6;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            padding: 20px;
            background: #f8f9ff;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-card h3 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 5px;
        }
        
        .stat-card p {
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Calibration Quiz</h1>
            <p>Test how well you know what you know</p>
        </div>
        
        <!-- Setup Screen -->
        <div id="setupScreen" class="setup-screen">
            <h2>Choose Your Question Set</h2>
            
            <div class="question-set-selector">
                <label for="questionSetSelect">Select a question set:</label>
                <select id="questionSetSelect">
                    <option value="">-- Select --</option>
                </select>
            </div>
            
            <div class="file-upload" onclick="document.getElementById('csvUpload').click()">
                <p style="font-size: 1.2em; margin-bottom: 10px;">üìÅ Or upload your own CSV</p>
                <p style="color: #666;">Click to browse or drag and drop</p>
                <input type="file" id="csvUpload" accept=".csv">
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" id="startQuizBtn" disabled>Start Quiz</button>
            </div>
        </div>
        
        <!-- Quiz Screen -->
        <div id="quizScreen" class="quiz-screen hidden">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <p style="text-align: center; color: #666; margin-bottom: 20px;">
                Question <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span>
            </p>
            
            <div class="question-card" id="questionCard">
                <div class="question-text" id="questionText"></div>
                <div class="options" id="optionsContainer"></div>
                
                <div class="confidence-slider">
                    <label>How confident are you in this answer?</label>
                    <div class="slider-container">
                        <input type="range" id="confidenceSlider" min="0" max="100" value="50">
                        <span class="confidence-value"><span id="confidenceValue">50</span>%</span>
                    </div>
                </div>
            </div>
            
            <div class="navigation">
                <button class="btn btn-secondary" id="prevBtn">Previous</button>
                <button class="btn" id="nextBtn">Next</button>
            </div>
        </div>
        
        <!-- Results Screen -->
        <div id="resultsScreen" class="results-screen hidden">
            <h2 style="text-align: center; margin-bottom: 20px;">Your Results</h2>
            
            <div class="category-result" id="categoryResult"></div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="accuracyStat">0%</h3>
                    <p>Overall Accuracy</p>
                </div>
                <div class="stat-card">
                    <h3 id="avgConfidenceStat">0%</h3>
                    <p>Average Confidence</p>
                </div>
                <div class="stat-card">
                    <h3 id="calibrationStat">0</h3>
                    <p>Calibration Score</p>
                </div>
            </div>
            
            <div class="results-toggle">
                <button class="toggle-btn active" id="chartBtn">Chart View</button>
                <button class="toggle-btn" id="tableBtn">Table View</button>
            </div>
            
            <div id="chartView" class="chart-container">
                <canvas id="calibrationChart"></canvas>
            </div>
            
            <div id="tableView" class="hidden">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Question</th>
                            <th>Your Answer</th>
                            <th>Correct</th>
                            <th>Confidence</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody"></tbody>
                </table>
            </div>
            
            <div style="text-align: center; margin-top: 30px; display: flex; gap: 15px; justify-content: center;">
                <button class="btn" id="downloadPdfBtn">Download PDF</button>
                <button class="btn btn-secondary" id="restartBtn">Take Another Quiz</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let questionSets = {};
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let chart = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadQuestionSets();
            setupEventListeners();
            checkUrlParams();
        });

        function checkUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const setParam = params.get('set');
            if (setParam && questionSets[setParam]) {
                document.getElementById('questionSetSelect').value = setParam;
                loadQuestionSet(setParam);
            }
        }

        function loadQuestionSets() {
            // Configuration: Add your CSV files here
            const csvFiles = [
                { key: 'sample', name: 'Sample Questions', path: 'questions/sample-questions.csv' }
                // Add more question sets like this:
                // { key: 'trivia', name: 'General Trivia', path: 'questions/trivia.csv' },
                // { key: 'risk', name: 'Risk Assessment', path: 'questions/risk-assessment.csv' }
            ];

            const select = document.getElementById('questionSetSelect');

            // Load each CSV file
            csvFiles.forEach(file => {
                fetch(file.path)
                    .then(response => {
                        if (!response.ok) {
                            console.error(`Could not load ${file.path}`);
                            return null;
                        }
                        return response.text();
                    })
                    .then(csvText => {
                        if (!csvText) return;

                        Papa.parse(csvText, {
                            header: true,
                            complete: (results) => {
                                const questions = results.data
                                    .filter(row => row.question && row.question.trim())
                                    .map(row => ({
                                        question: row.question,
                                        options: [row.option_a, row.option_b, row.option_c, row.option_d].filter(o => o),
                                        correct: row.correct_answer.toUpperCase().charCodeAt(0) - 65
                                    }));

                                if (questions.length > 0) {
                                    questionSets[file.key] = {
                                        name: file.name,
                                        data: questions
                                    };

                                    // Add to dropdown
                                    const option = document.createElement('option');
                                    option.value = file.key;
                                    option.textContent = file.name;
                                    select.appendChild(option);

                                    // Check URL params after loading
                                    checkUrlParams();
                                }
                            }
                        });
                    })
                    .catch(error => {
                        console.error(`Error loading ${file.path}:`, error);
                    });
            });
        }

        function setupEventListeners() {
            document.getElementById('questionSetSelect').addEventListener('change', (e) => {
                if (e.target.value) {
                    loadQuestionSet(e.target.value);
                }
            });

            document.getElementById('csvUpload').addEventListener('change', handleFileUpload);
            document.getElementById('startQuizBtn').addEventListener('click', startQuiz);
            document.getElementById('prevBtn').addEventListener('click', previousQuestion);
            document.getElementById('nextBtn').addEventListener('click', nextQuestion);
            document.getElementById('confidenceSlider').addEventListener('input', (e) => {
                document.getElementById('confidenceValue').textContent = e.target.value;
            });
            document.getElementById('chartBtn').addEventListener('click', () => toggleView('chart'));
            document.getElementById('tableBtn').addEventListener('click', () => toggleView('table'));
            document.getElementById('downloadPdfBtn').addEventListener('click', downloadPDF);
            document.getElementById('restartBtn').addEventListener('click', restart);
        }

        function loadQuestionSet(key) {
            currentQuestions = questionSets[key].data;
            document.getElementById('startQuizBtn').disabled = false;
        }

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            Papa.parse(file, {
                header: true,
                complete: (results) => {
                    const questions = results.data
                        .filter(row => row.question && row.question.trim())
                        .map(row => ({
                            question: row.question,
                            options: [row.option_a, row.option_b, row.option_c, row.option_d].filter(o => o),
                            correct: row.correct_answer.toUpperCase().charCodeAt(0) - 65
                        }));

                    if (questions.length > 0) {
                        currentQuestions = questions;
                        document.getElementById('startQuizBtn').disabled = false;
                        alert(`Loaded ${questions.length} questions from CSV!`);
                    }
                },
                error: (error) => {
                    alert('Error parsing CSV: ' + error.message);
                }
            });
        }

        function startQuiz() {
            currentQuestionIndex = 0;
            userAnswers = [];
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');
            document.getElementById('totalQuestions').textContent = currentQuestions.length;
            showQuestion();
        }

        function showQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const div = document.createElement('div');
                div.className = 'option';
                div.textContent = option;
                div.onclick = () => selectOption(index);
                if (userAnswers[currentQuestionIndex]?.answer === index) {
                    div.classList.add('selected');
                }
                optionsContainer.appendChild(div);
            });

            // Restore confidence if previously set
            const savedConfidence = userAnswers[currentQuestionIndex]?.confidence || 50;
            document.getElementById('confidenceSlider').value = savedConfidence;
            document.getElementById('confidenceValue').textContent = savedConfidence;

            // Update progress
            const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            // Update buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            document.getElementById('nextBtn').textContent = 
                currentQuestionIndex === currentQuestions.length - 1 ? 'Finish' : 'Next';
        }

        function selectOption(index) {
            document.querySelectorAll('.option').forEach((opt, i) => {
                opt.classList.toggle('selected', i === index);
            });

            if (!userAnswers[currentQuestionIndex]) {
                userAnswers[currentQuestionIndex] = {};
            }
            userAnswers[currentQuestionIndex].answer = index;
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                saveCurrentAnswer();
                currentQuestionIndex--;
                showQuestion();
            }
        }

        function nextQuestion() {
            const current = userAnswers[currentQuestionIndex];
            if (!current || current.answer === undefined) {
                alert('Please select an answer');
                return;
            }

            saveCurrentAnswer();

            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            } else {
                showResults();
            }
        }

        function saveCurrentAnswer() {
            const confidence = parseInt(document.getElementById('confidenceSlider').value);
            if (!userAnswers[currentQuestionIndex]) {
                userAnswers[currentQuestionIndex] = {};
            }
            userAnswers[currentQuestionIndex].confidence = confidence;
        }

        function showResults() {
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');

            // Calculate results
            const results = calculateResults();
            displayResults(results);
        }

        function calculateResults() {
            let correct = 0;
            let totalConfidence = 0;
            const calibrationBuckets = Array(11).fill(0).map(() => ({
                count: 0,
                correct: 0,
                avgConfidence: 0
            }));

            userAnswers.forEach((answer, index) => {
                const isCorrect = answer.answer === currentQuestions[index].correct;
                if (isCorrect) correct++;
                
                totalConfidence += answer.confidence;

                // Add to calibration bucket
                const bucket = Math.floor(answer.confidence / 10);
                calibrationBuckets[bucket].count++;
                if (isCorrect) calibrationBuckets[bucket].correct++;
                calibrationBuckets[bucket].avgConfidence += answer.confidence;
            });

            const accuracy = (correct / userAnswers.length) * 100;
            const avgConfidence = totalConfidence / userAnswers.length;

            // Calculate calibration score (mean absolute difference)
            let calibrationScore = 0;
            let bucketsUsed = 0;
            calibrationBuckets.forEach(bucket => {
                if (bucket.count > 0) {
                    const bucketAccuracy = (bucket.correct / bucket.count) * 100;
                    const bucketConfidence = bucket.avgConfidence / bucket.count;
                    calibrationScore += Math.abs(bucketAccuracy - bucketConfidence);
                    bucketsUsed++;
                }
            });
            calibrationScore = bucketsUsed > 0 ? calibrationScore / bucketsUsed : 0;

            // Determine category
            const bias = avgConfidence - accuracy;
            let category, description;
            if (Math.abs(bias) < 10) {
                category = 'Well Calibrated';
                description = 'Your confidence matches your accuracy well. You have a good sense of what you know and don\'t know.';
            } else if (bias > 0) {
                category = 'Overconfident';
                description = 'You tend to be more confident than your actual accuracy suggests. Consider being more cautious in your certainty.';
            } else {
                category = 'Underconfident';
                description = 'You tend to be less confident than your actual accuracy suggests. You may know more than you think!';
            }

            return {
                accuracy,
                avgConfidence,
                calibrationScore,
                category,
                description,
                calibrationBuckets
            };
        }

        function displayResults(results) {
            document.getElementById('accuracyStat').textContent = results.accuracy.toFixed(1) + '%';
            document.getElementById('avgConfidenceStat').textContent = results.avgConfidence.toFixed(1) + '%';
            document.getElementById('calibrationStat').textContent = results.calibrationScore.toFixed(1);

            document.getElementById('categoryResult').innerHTML = `
                <h2>${results.category}</h2>
                <p>${results.description}</p>
            `;

            // Create chart
            createCalibrationChart(results.calibrationBuckets);

            // Create table
            const tbody = document.getElementById('resultsTableBody');
            tbody.innerHTML = '';
            userAnswers.forEach((answer, index) => {
                const question = currentQuestions[index];
                const isCorrect = answer.answer === question.correct;
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${question.question.substring(0, 50)}${question.question.length > 50 ? '...' : ''}</td>
                    <td>${question.options[answer.answer]}</td>
                    <td style="color: ${isCorrect ? 'green' : 'red'}; font-weight: bold;">
                        ${isCorrect ? '‚úì' : '‚úó'}
                    </td>
                    <td>${answer.confidence}%</td>
                `;
            });
        }

        function createCalibrationChart(buckets) {
            const ctx = document.getElementById('calibrationChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            const labels = [];
            const accuracyData = [];
            const confidenceData = [];

            buckets.forEach((bucket, index) => {
                if (bucket.count > 0) {
                    const rangeStart = index * 10;
                    const rangeEnd = (index + 1) * 10;
                    labels.push(`${rangeStart}-${rangeEnd}%`);
                    accuracyData.push((bucket.correct / bucket.count) * 100);
                    confidenceData.push(bucket.avgConfidence / bucket.count);
                }
            });

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Actual Accuracy',
                            data: accuracyData,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: 'Confidence',
                            data: confidenceData,
                            borderColor: '#764ba2',
                            backgroundColor: 'rgba(118, 75, 162, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: 'Perfect Calibration',
                            data: labels.map((_, i) => (i + 0.5) * 10),
                            borderColor: '#48bb78',
                            borderDash: [5, 5],
                            pointRadius: 0,
                            tension: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Calibration Curve',
                            font: { size: 16 }
                        },
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Percentage'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Confidence Range'
                            }
                        }
                    }
                }
            });
        }

        function toggleView(view) {
            const chartView = document.getElementById('chartView');
            const tableView = document.getElementById('tableView');
            const chartBtn = document.getElementById('chartBtn');
            const tableBtn = document.getElementById('tableBtn');

            if (view === 'chart') {
                chartView.classList.remove('hidden');
                tableView.classList.add('hidden');
                chartBtn.classList.add('active');
                tableBtn.classList.remove('active');
            } else {
                chartView.classList.add('hidden');
                tableView.classList.remove('hidden');
                chartBtn.classList.remove('active');
                tableBtn.classList.add('active');
            }
        }

        async function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            
            // Title
            pdf.setFontSize(24);
            pdf.setTextColor(102, 126, 234);
            pdf.text('Calibration Quiz Results', 105, 20, { align: 'center' });
            
            // Category
            pdf.setFontSize(16);
            pdf.setTextColor(0, 0, 0);
            const category = document.getElementById('categoryResult').querySelector('h2').textContent;
            pdf.text('Category: ' + category, 20, 40);
            
            // Stats
            pdf.setFontSize(12);
            const accuracy = document.getElementById('accuracyStat').textContent;
            const avgConf = document.getElementById('avgConfidenceStat').textContent;
            const calibScore = document.getElementById('calibrationStat').textContent;
            
            pdf.text('Overall Accuracy: ' + accuracy, 20, 55);
            pdf.text('Average Confidence: ' + avgConf, 20, 65);
            pdf.text('Calibration Score: ' + calibScore, 20, 75);
            
            // Chart
            const canvas = document.getElementById('calibrationChart');
            const chartImage = canvas.toDataURL('image/png');
            pdf.addImage(chartImage, 'PNG', 20, 85, 170, 100);
            
            // Table
            pdf.addPage();
            pdf.setFontSize(16);
            pdf.text('Detailed Results', 20, 20);
            
            pdf.setFontSize(10);
            let y = 35;
            userAnswers.forEach((answer, index) => {
                if (y > 270) {
                    pdf.addPage();
                    y = 20;
                }
                const question = currentQuestions[index];
                const isCorrect = answer.answer === question.correct;
                const shortQ = question.question.substring(0, 60) + (question.question.length > 60 ? '...' : '');
                
                pdf.text(`${index + 1}. ${shortQ}`, 20, y);
                pdf.text(`Answer: ${question.options[answer.answer]}`, 25, y + 5);
                pdf.text(`Correct: ${isCorrect ? 'Yes' : 'No'} | Confidence: ${answer.confidence}%`, 25, y + 10);
                y += 20;
            });
            
            pdf.save('calibration-quiz-results.pdf');
        }

        function restart() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('setupScreen').classList.remove('hidden');
            document.getElementById('questionSetSelect').value = '';
            document.getElementById('startQuizBtn').disabled = true;
            currentQuestions = [];
            currentQuestionIndex = 0;
            userAnswers = [];
            if (chart) {
                chart.destroy();
                chart = null;
            }
        }
    </script>
